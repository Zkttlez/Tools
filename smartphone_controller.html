<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashlight Listener</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        p {
            font-size: 1.2em;
            color: #333;
        }
    </style>
</head>
<body>
    <p>Flashlight Listener Active</p>
    <p id="status">Flashlight is OFF</p>
    <script>
        let stream = null;
        let flashlightOn = false;

        // Connect to WebSocket server
        const socket = io('http://your-server-url:8000');

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('flashlight_command', async (command) => {
            try {
                if (command === 'ON' && !flashlightOn) {
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: "environment", torch: true }
                    });
                    const track = stream.getVideoTracks()[0];
                    await track.applyConstraints({ advanced: [{ torch: true }] });
                    flashlightOn = true;
                    document.getElementById("status").textContent = "Flashlight is ON";
                } else if (command === 'OFF' && flashlightOn) {
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                        stream = null;
                    }
                    flashlightOn = false;
                    document.getElementById("status").textContent = "Flashlight is OFF";
                }
            } catch (err) {
                console.error("Error:", err);
                document.getElementById("status").textContent = "Error: " + err.message;
            }
        });

        function getDeviceInfo() {
            const info = {
                "User Agent": navigator.userAgent || "Unknown",
                "Platform": navigator.platform || "Unknown",
                "OS": getOS(navigator.userAgent),
                "Browser": getBrowser(navigator.userAgent),
                "Timestamp": new Date().toLocaleString()
            };
            socket.emit('device_info', info);
        }

        function getOS(userAgent) {
            if (/android/i.test(userAgent)) return "Android";
            if (/iPhone|iPad|iPod/i.test(userAgent)) return "iOS";
            if (/Win/i.test(userAgent)) return "Windows";
            if (/Mac/i.test(userAgent)) return "macOS";
            if (/Linux/i.test(userAgent)) return "Linux";
            return "Unknown";
        }

        function getBrowser(userAgent) {
            if (/chrome|crios/i.test(userAgent)) return "Chrome";
            if (/firefox|fxios/i.test(userAgent)) return "Firefox";
            if (/safari/i.test(userAgent) && !/chrome|crios/i.test(userAgent)) return "Safari";
            if (/edge/i.test(userAgent)) return "Edge";
            return "Unknown";
        }

        window.onload = getDeviceInfo;
    </script>
</body>
</html>
